---
title: "`r Sys.getenv('PROJ_TITLE')`"
subtitle: 0.0.0.9000
description: "`r Sys.getenv('PROJ_DESCRIPTION')`"
author:
  - name: Andrea Pedot
    orcid_id: "0000-0002-0520-7428"
    affiliation: Unit of Biostatistics, Epidemiology, and Public Health
    affiliation_url: https://www.unipd-ubep.it/
  - name: Corrado Lanera
    url: https://CorradoLanera.it
    orcid_id: "0000-0002-0520-7428"
    affiliation: Unit of Biostatistics, Epidemiology, and Public Health
    affiliation_url: https://www.unipd-ubep.it/
citation_url: "`r Sys.getenv('PROJ_URL')`"
date: "`r Sys.Date()`"
bibliography:  biblio.bib #[packages.bib, biblio.bib]
preview: man/img/LAIMS.png
self-contained: true
output:
  distill::distill_article:
    toc: true
    toc_depth: 2
    code_folding: true
---

<!-- DON'T RENDER THE REPORT BY HAND DIRECTLY! -->

<!-- use `targets::tar_make()` instead -->

```{r setup, include=FALSE}
options(
  width = 90,
  tidyverse.quiet = TRUE
)

knitr::opts_chunk$set(
  echo = FALSE,
  collapse = TRUE,
  comment = ""
)

library(glue)
library(here)
library(targets)
library(tidyverse)

list.files(here("R"), pattern = "\\.R$", full.names = TRUE) |>
  lapply(source) |> invisible()
```

```{r, echo=FALSE}
htmltools::img(
 src = knitr::image_uri(here("man", "img", "LAIMS.png")),
 alt = 'logo',
 style = 'position:absolute; top:0; right:0; padding:10px;'
 )
```

```{r, include=FALSE}
knitr::write_bib(file = './reports/packages.bib')
```

```{r packages, include=FALSE}

```

## Introduction

The project focuses on the geospatial analysis of a cholera outbreak in Yemen between 2017 and 2018, using various techniques that leverage the spatial dimension of data.

### Cholera epidemiology and risk factors

Cholera is a worldwide problem. It is a highly virulent disease that spreads through the contamination of food and water [\@azman_incubation]. The World Health Organization considers it a global threat to public health and an indicator of inequity and lack of social development [@who_cholera]. The typical presentation is a patient with severe acute watery diarrhoea, with severe cases that can cause severe dehydration or even death if left untreated.

Unfortunately, accessing supportive care can be complicated, even if it proves cheap and effective. Most patients can be treated successfully through the Oral Rehydration Solution (ORS), up to 6 litres on the first day. Those interventions should be available at the community level (Oral Rehydration Points, or ORP). If the patient is at risk of shock, intravenous fluids and antibiotics are required, usually in Cholera Treatment Units (CTUs) or Centers (CTCs). For under-5 children, Zync is an effective supplement to add to ORS therapy. **The Case Fatality Rate (CFR) should remain under 1% when treatment is provided early.**

The disease is caused by *Vibrio cholerae*, a bacteria that began spreading during the 19th century from its original reservoir in the Ganges delta in India. Most people infected don't develop any symptoms (but are nevertheless contagious and will shed the bacteria through their faeces for 1-10 days after infection). Most of those who develop symptoms have mild to moderate ones, usually between 12 hours and five days. A minority of patients will develop the severe form, which is threatening patient survival [@who_cholera].

Out of the many serogroups of V. cholerae, only O1 and O139 have an outbreak potential. O1 itself caused all the recent outbreaks, but there is no way to distinguish it from the clinical symptoms shown by the patients.

Cholera transmission is closely linked to the lack of Water Access, Sanitation, and Hygiene services, particularly restrooms and other facilities. Particularly at high risk are peri-urban areas with precarious conditions (slums), overcrowded Internally Displaced People camps, or remote areas where the population relies on unprotected water sources [@who_cholera]. Without proper sanitation and waste management systems, water sources can become further contaminated, and the water scarcity problem is even worse during drought or flooding [@one_health].

The world is currently experiencing the 7th pandemic, which started in South Asia in 1961, reached Africa in 1971, and the Americas in 1991. It is now considered endemic in many countries. WHO continues to report a high number of cases, with 44 countries reporting them in 2022, for a total of nearly 0.5 million cases worldwide and more than 2,300 deaths.

A series of interventions is required to control Cholera and reduce deaths, combining early warning and surveillance systems and strengthening health and WASH systems [@who_cholera]. The Red Cross Movement adopts a three-pronged approach:

-   **Break the transmission chain** through community mobilisation and volunteer engagement in Branch Outbreak Response Teams. The interventions incorporate local culture, practices, and beliefs to promote good hygiene practices and prevent contamination or re-contamination.

-   **Lower mortality** through Oral Rehydration Solution distribution in established points (ORPs) or outposts. This is critical, as the local health system may be unable to develop the required number of ORPs.

-   **Oral Cholera Vaccination (OCV) campaigns**, whenever those are available through the Global OCV stockpile supported by Gavi, the Vaccine Alliance

The appropriate timing of those interventions and the geographical area where they need to be implemented are crucial factors in Outbreak Control [@ifrc_cholera]. On the other hand, long-term solutions entail developing the WASH infrastructure and improving socio-economic conditions [@who_cholera].

Surveillance is an integrated system that ensures prompt detection of suspected cholera cases, followed by information sharing with other health system levels, up to international notification according to the International Health Regulations (IHR). The suspect is based on clinical suspicion (acute watery diarrhoea in a patient older than two years, with severe dehydration or death). Rapid diagnostic tests are valuable tools at the healthcare facility level but are not available everywhere. The PCR test is the usual laboratory confirmation carried out by country-level authorities since even a single case is considered an outbreak, as per the IHR, even if the notification is no longer mandatory but follows the criteria specified in Annex 2 [@ihr].

The Global Roadmap to Ending Cholera [@gtfcc_roadmap] is an initiative of the Global Taskforce on Cholera Control that focuses on three strategic axes:

1. Early detection and quick response to contain outbreaks

2. A targeted multi-sectoral approach to prevent cholera recurrence, focusing on cholera hotspots, which are relatively small areas that are the most chronically affected by cholera cases

3. An effective mechanism of coordination for technical support, advocacy, resource mobilisation, and partnership at local and global levels

This thesis project focuses on the First Strategic Pillar and aims to prove the feasibility of Anticipatory Approaches to cholera outbreaks.

### Cholera burden globally

Unfortunately, the global burden of Cholera is unknown mainly because the majority of cases are not reported. The low reporting can be attributed to the limited capacity of epidemiological surveillance and laboratories and social, political, and economic disincentives for reporting.

Approximately 1.3 billion people are at risk for Cholera in endemic countries. An estimated 2.86 million cholera cases (uncertainty range: 1.3m-4.0m) occur annually in endemic countries. Among these cases, there are an estimated 95,000 deaths (uncertainty range: 21,000-143,000) [@cholera_burden].

[![Annual number of cholera cases in endemic countries](./img/worlwide_cholera_cases.jpg)](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4455997/figure/pntd.0003832.g002/)

### Cholera Burden in Yemen

According to the World Bank, Yemen is a lower-middle-income country with a population of more than 26 million. However, due to ongoing conflicts, its population health indicators are some of the lowest in the world [@wb].

Yemen is considered a country where Cholera is endemic, given that cases are routinely observed. The Global burden of disease estimates 10.7 million people at risk, with an incidence rate (1000) of 1.64 and more than 17500 cases annually, a Case Fatality Rate of 3.2, and 561 deaths annually [@cholera_burden]. Cumulatively, between 2016 and 2021, more than 2.5 million cases were reported, including 4000 deaths [@echo_yemen].

The current analysis focuses on the 2017-2018 outbreak, but even at the end of 2023, cholera cases surged in six governorates in Yemen. According to the DG ECHO, 80% of cases were among migrants [@echo_yemen]. Nonetheless, the Ministry of Public Health and Population in Aden declared the official outbreak at the national level only later. In March, there was an increase again in the northern governorates with over 6000 suspected cholera cases, 56 deaths (case fatality rate of 0.9%), and 47% of cases being clinically severe [@unicef_yemen]. In June 2024, the International Organisation on Migration (IOM) raised concerns over 30,000 suspected cases, potentially reaching 255,000 by September 2024 if preparedness and response activities are not scaled up [@iom_yemen].

Yemen experienced the most significant reported cholera outbreak in recent history, from 2016 to 2022. The analysis focuses on a short period for which epidemiological data are available. The main driver has been a protracted civil war, which damaged the already vulnerable health and WASH infrastructure. Chronic malnutrition, cyclical floods, and drought episodes have compounded this[@one_health].

[![Total number of suspected cholera cases in Yemen and associated case-fatality rate (CFR) from 2009 to 2019.](./img/yemen_outbreak.jpg)](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7411249/figure/f1-jpmph-20-154/)

The situation worsened in late 2016, as seen from the Chart. This resulted in more than 16 million people without essential services and more than 2 million IDPs being forced to live in deprived and harsh environments. This contributed to a sustained number of cases, probably due to groundwater contamination and a general lack of safe drinking water in the country [@one_health]. A national electronic Disease Early Warning System (eDEWS) was established in 2016 and used together with the Bulletin of the Yemen Ministry of Health to monitor the evolution of the outbreak, providing a reliable source of data even if not always timely due to the ongoing conflict [@ews_yemen].

Increased rainfall, flooding, and a powerful El Niño and winds may have further contaminated water sources in Yemen and aided the spread of cholera-contaminated flying insects (chironomids) from the Horn of Africa to Yemen [@paz_cholera_2019].

### Anticipatory Action

The UN Office for the Coordination of Humanitarian Affairs (OCHA) defines Anticipatory Action (AA) as those taken ahead of a disaster to support vulnerable communities. AA emerges from the increasing confidence that we can predict the occurrence and impact of some hazards [@aa_ocha].

It is composed of three main components:

1. A pre-agreed trigger consists of thresholds and decision-making rules based on reliable, timely, measurable forecasts. The advancement of weather forecasting and climate science enables more actions [@aa_rccc].

2.  **Pre-agreed activities:** This consists of accountable, feasible, effective and efficient actions to be implemented to support vulnerable communities in the window of opportunity between the trigger moment and the full impact of a shock

3.  **Pre-arranged financing:** This consists of guaranteed funding available to be released based on the pre-agreed trigger for the pre-agreed activities.

The Red Cross Movement usually adds a fourth component: the capacity to implement those actions on time. This is crucial, and capacity-building efforts are needed to ensure readiness is non-trivial. Depending on the type of hazard and forecasts available, anticipatory action can be carried out well ahead of the shock (for slower onset events) or just before the impacts fully take hold (for more rapid-onset events) [@aa_ahub].

The International Federation of Red Cross Red Crescent Societies defines with a broader scope the actions taken to reduce the humanitarian impacts of a forecast hazard before it occurs or before its most acute impacts are felt [@aa_ifrc, @aa_ifrc2]. This additional component enables the definition to be extended to epidemics.

The decision to act is based on a forecast, or collective risk analysis, of when, where and how the event will unfold. Anticipatory action is reshaping the humanitarian system, shifting from reacting to hazards to acting ahead of them [@aa_ahub].

### Anticipatory Action for Epidemics

Even if there is great attention on Anticipatory Action for Epidemics, only a few viable examples are available. Anticipation Hub recognises that technological progress in scientific modelling and forecasting systems is enabling better predictions of who, how, when, and where people might be affected by disease outbreaks and epidemics [@aa_health].

Health hazards differ from weather-related ones in different ways:

-   Risk Analysis and Early Warning systems in the health sector are radically different since forecasting models are of a different nature. Also, it is widespread in the Health sector to base clinical and public health decisions on risk assessment tools instead of hard thresholds. This is done to enable contextual information, difficult to capture in triggers, to be part of the decision process [@who_risk]

-   The political sensitivity of activation, which makes relying on historical data difficult, given both the delays in reporting and the different capacity of health systems to report

-   Early Actions are interlinked with the disaster impact. While for cyclones AA can reduce the impact, for Epidemics, the number of cases itself depends on the Early Actions, thus changing the disaster

In 2021, the World Health Organization (WHO), UNICEF, the International Organization for Migration (IOM), as well as scientists and researchers from the medical, public health, and climate communities are working to test if anticipatory action can stop an outbreak from becoming a crisis in Yemen, Mozambique, and the Democratic Republic of the Congo. The pilot initiative, part of a larger portfolio to scale up anticipatory action, is co-sponsored by the UN Office for the Coordination of Humanitarian Affairs (OCHA), the Global Task Force on Cholera Control (GTFCC), the Risk-Informed Early Action Partnership (REAP), the UK Government, and the Red Cross, and financed by the UN Central Emergency Response Fund (CERF) [@aa_health2].

Particularly in the trigger part, it is recognised that triggers can take into consideration different factors:

-   Suspected cholera cases before confirmation from the laboratory or reported cases in nearby locations to anticipate preparedness activities and scale up surveillance systems

-   Sudden shocks such as floods, drought or large displacement waves.

-   A reduction in vaccine coverage or deteriorating water and sanitation conditions.

-   Temperature, rainfall, and other predictable environmental factors will provide significant additional lead time and help dynamically target at-risk areas, including where to detect contaminated water.

-   ...

Those different possibilities have been reduced to three main approaches in the recent "Anticipatory Action for Epidemics" briefing from the Anticipation Hub [@alcayna_anticipatory_2023], with also suggestions on how to develop them:

1. Identify the health impacts of hydrometeorological hazards, including a health component into existing protocols for other hazards, such as floods or cyclones.

2. Multi-stepped composite (surveillance and aggravating factors). This approach combines different indicators, including surveillance data on the disease of interest and known drivers of disease transmission, to establish a composite trigger.

3. Mathematical models predict outbreak risk and the probability of a future outbreak in a given country or location.

That said, developing a protocol for Epidemics requires shifting the mindset from preventing an outbreak to preventing it from reaching critical levels.

## Methods

### Main objective of the analysis

Usually, disease Early Warning systems focus on defining an alert or alarm level for the administrative subdivision where the suspected or confirmed case is found. This analysis aims to explore the geographical and temporal dimensions of a two-year-long Cholera outbreak in Yemen and test the feasibility of an alert for neighbouring areas with different lead times.

### Analysis Plan

Given the complexity of the task, a few assumptions are kept:

-   At this stage, no meteorological data is integrated. The model relies only on epidemiological variables in each administrative area.

-   The analysis focuses on the first administrative level since data are made freely available only at this level.

-   No considerations are made for population movement (e.g., road network or local markets) or displacement dynamics (e.g., within or across the country). Only the geographical proximity of the administrative areas is considered.

Exploration of temporal and geographical dynamics:

-   Case Fatality and Attack rates need to be smoothened through a BYM Model. This will mask the effect of overdispersion and identify areas where CFR and AR are exceptionally high. Both variables are calculated in the previous three weeks (as in the OCHA paper [@drc_cholera]).

-   Each area is classified into three classes: either the outbreak is controlled (level 0 - preparedness), cases are on the surge but with CFR under the 1% threshold (level 1 - early action), or CFR is over 1%, signalling an unacceptable stress level (level 2 - response). Level 2 is declared also if the attack rate in the previous four weeks has been higher than 2 per 1000 people. This classification is calculated only on data available at that moment and is the target of prediction.

-   Two locations will be analysed for temporal correlation from a surge in cases in neighbouring districts through a Distributed Lag Model, identifying the best lead time for the following step. Pooled estimates are obtained to verify the temporal correlation of that with a meta-analytical approach.

Once the preprocessing and exploration are completed, modelling steps can be implemented.

-   The target of prediction is the level of a particular district, some weeks in advance, identified in the exploration stage.

-   Three models are tested: the first uses the number of cases, the second uses the CFR, and the third uses the districts' attack rates as input variables. All of them are BYM models with the 3-level classification as a covariate.

-   A fourth model, a non-bayesian Poisson model, is also used as a reference.

### Data sources

Data for this project come from two primary sources, both accessible through the Humanitarian Data Exchange portal.

#### Administrative subdivisions of Yemen

The UN Office for Coordination of Humanitarian Affairs provided a group of georeferenced shapefiles at the different administrative levels. For the current project, shapes are collected at the governorate level (adm 1) [@ocha_yemen].

Those data are prepared by the Central Statistical Organisation and distributed under a Creative Commons Attribution for Intergovernmental Organisations.

All data can be downloaded from [this website](https://data.humdata.org/dataset/cod-ab-yem "HDX Yemen OCHA boundaries"). In particular, the "Administrative Divisions Shapefiles.zip" contains the "yem_admbnda_adm1_govyem_cso_20191002.shp," which has been used for the project once copied into the folder "data-raw."

#### Yemen Cholera Outbreak Epidemiology Update Data

This dataset provides numbers of suspected cholera cases, deaths, case fatality rates (%) and attack rates (per 1,000) by governorate in the Yemen cholera outbreak since 27 April 2017. The data contains figures from epi bulletins and weekly and daily bulletins. The data are manually extracted from the Yemen cholera outbreak epidemiology updates produced by WHO Yemen. The same license as the previous dataset applies. Unfortunately, after 18 February 2018, governorate level updates were discontinued [@epi_yemen].

All data can be downloaded from [this website](https://data.humdata.org/dataset/yemen-cholera-outbreak-daily-epidemiology-update? "WHO Yemen cholera updates"), particularly the "Yemen Governorate Level Cholera Epidemiology Data.csv", which was then used for the project once copied into the folder "data-raw". Different variables are available, in **bold** the one maintained for subsequent analysis.

-   **Date** when the figures were reported

-   The **Governorate** name, as reported in the WHO epidemiology bulletin

-   Number of **Cases** recorded in the governorate since 27 April 2017

-   Number of **Deaths** recorded in the governorate since 27 April 2017

-   **CFR** (%), the case fatality rate in the governorate since 27 April 2017

-   **Attack Rate** (per 1000), the attack rate per 1,000 of the population

-   COD Gov English/COD Gov Arabic/COD Gov Pcode (3 columns). The English/Arabic/PCODE name for the governorate according to the Inter-Agency Standing Committee (IASC) Common Operation Datasets (CODs) for Yemen

-   The type of bulletin from which the data was extracted (includes Epidemiology bulletin, Weekly epidemiology bulletin, Daily epidemiology update)

-   The URL of the bulletin from which the data was extracted.

### Data preprocessing

The main tools for the whole project have been R Statistical Software [@rlanguage] and OpenBugs [@lunn_bugs_2009] for the Bayesian modelling. A GitHub repo has been created to facilitate version control and the laims.analysis template has been used. The template incorporates most of the libraries needed to reduce the pipeline creation and maintenance and isolates the whole project as a package. The complete pipeline can be seen in the image below.

```{r}
targets::tar_visnetwork(targets_only = TRUE,exclude = starts_with("fig"))
```

The above figure shows different preprocessing steps, which are available as part of the package:

-   Grouping data from different reports by Epidemiological Week and Governorate so that they can be visualised and analysed on a constant time frame

-   Merging the Yemen shapefile with the epidemiological data (cases, deaths, CFR and attack rate), grouped by epidemiological week.

-   Calculating the adjacency matrix used for the BYM models.

-   Calculate the target variable and the 3-weekly CFR, as well as new cases and attack rate, as per the analytical plan.

## Results and discussion

Results and discussion follow the pipeline outlined above. Data integrity information is checked before proceeding in the results presentation.

Fig 1a - gtsummary

### Data exploration and visualisation - Temporal trends

The 4 main variables to track a cholera outbreak are the number of cases, the attack rate, deaths and Case Fatality Rate. To have a general picture, the absolute values (since the start of the outbreak) are visualised, both by district and cumulative.

```{r, figures-1b-cases}
#Fig 1b - same as 1c  but broken down by district
tar_read(fig_1b_1)
```

Different dynamics are shown across the 21 governorates analyzed, with some of them (Abyan, Ad Dali, Shabwa, ...) that show a stop after the initial increase, while others that never managed to control the outbreaks (Dhamar, Sanaa both rural and city, Raymah,...).

Another interesting phenomenon, is the sudden spikes into the first derivative, as it can be observed in Sanaa (rural), Hadramawt, or Shabwah, where the new cases are grouped in a short timeframe that is indicative of an immediate worsening of the situation.

```{r, figures-1b-ar}
tar_read(fig_1b_2)
```

The attack rate is one of the fundamental variables that drive the resources needed to control an outbreak. Since it's calculated on the new cases and the population, attack rate follows a similar shape as the new cases, but it is the peak that is most indicative. Districts as Al Mahwit and Amran (AR = 75 per thousand) are across the most affected governorates, while in Sadah (AR = 12) and Hadramawt (AR = 1.5) most of the people managed to avoid the infection. Other drivers may explain that, as the limited testing due to volatile access conditions, but in general the Attack rate analysis shows different dynamics across the Country.

```{r, figures-1b-deaths}
tar_read(fig_1b_3)
```

Deaths are a hard outcome that is usually easy to report at the Health Facility level, compared to other indicators. Even in this case, there is great variability across the regions, spanning from only few recorded deaths (Sadah, Shabwah) to hundreds of them (Amran, Ibb, Taiz,...). Since cholera does not usually give permanent disabilities, death is the most important outcome to be monitored, but as for the absolute number of new cases, to understand the implication a new metric is needed.

```{r, figures-1b-cfr}
tar_read(fig_1b_4) +
  geom_hline(yintercept = 1, color = "red")
```

Case-Fatality Rate, apart from setting standards for the assistance provided (should be \<1%), is also a factor that shows the efficacy of the health system as a whole. In the dataset, it is shown the absolute CFR (from the start of the outbreak), so it's the only variable that is steadily decreasing. This, though, does not provide information on the moment by moment evolution of the outbreak.

In addition to that, is notable that at the beginning of the outbreak in most of the regions, a spike is seen. This is due to a combination of factors: at the beginning, confirmed cases are low and are usually the worst in terms of clinical conditions. But also, scaling up the health systems capacity and risk communiction activities are effective ways to lower the overall mortality (and fatality, as well).

```{r, figures-1c-upper, fig.show="hold", out.width="50%"}
#Fig 1c - whole epidemic curve (4 panels with the 4 epi variables)
tar_read(fig_1c_1)
tar_read(fig_1c_2) +
  geom_hline(yintercept = 1, color = "red")
```

From a country level point of view, the Outbreak has never been controlled in the study period, probably due to the vulnerability factors outlined in the introduction. This is different from the governorates-level data, where the levelling off in some districts of the cases is a sign of a controlled outbreak. Most notably, deaths and CFR have an interesting behaviour that was not evident from the previous data: Deaths steadily increase until July 2024 with a steady growth rate (linear), but from then on the growth is slower.

```{r, figures-1c-lower, fig.show="hold", out.width="50%"}
tar_read(fig_1c_3)
tar_read(fig_1c_4)
```

Even if cumulative data are the standard way to collect those information, additional variables have been calculated in the pre-processing to show the cumulative ones only in the previous 4 weeks, which provide a different picture, more representative of what happened in the previous month for that particular week.

```{r, figures-1e, fig.show="hold", out.width="50%"}
#Fig 1e - distribution of new cases and attack_rate  
tar_read(fig_1e_1)
tar_read(fig_1e_2)
```

```{r, figures-1f, fig.show="hold", out.width="50%"}
#Fig 1f - distribution of new_deaths and cfr  
tar_read(fig_1f_1) 
tar_read(fig_1f_2) +
  scale_x_sqrt() +
  xlim(-1,5) +
  geom_vline(xintercept = 1, color = "red")
```

All of the univariate distributions are left skewed, as it is usual for outbreaks (negative values in deaths are related to reporting errors). Combined, it shows a situation where in most of the districts for most of the times, the situation was managed in a way that avoided a humanitarian disaster. In fact, even in particular areas there were situations of dire humanitarian needs, the concerted efforts of the health autorities and international partners managed to contain the uncontrolled spread of the diseases.

```{r, figures-1d, fig.show="hold", out.width="33%"}
# Fig 1d - Three examples of different epi statuses situation w/colours  
tar_read(fig_1d_1) #Epi 2017-23 (early June) 
tar_read(fig_1d_2) #Epi 2017-35 (early September) 
tar_read(fig_1d_3) #Epi 2017-51 (early December)
```

From the key epidemiological variables, a general 3-coded status can be calculated. The cut-off has been defined within the scope of this work, without external validation (e.g., with government level risk assessment tools). Nevertheless, it uses similar definitions:

-   A green area is an area without any new cases in the past four weeks (which is slightly shorter than the WHO standard of 40 days)

-   A orange area is an area with an active outbreak where the health system is responding effectively

-   A red area is an area where the health sytems resources are not enought to keep either the CFR under the 1% threshold (representing a situation where sick people access the proper care and the adequate number of cases is intercepted by healthcare staff), or an attack rate over 2 (x1000) signalling a high level of community transmission, or failure of the mitigation measures.

Combined, the status provided in a glimpse the situation over the country. This is a useful target variable to predict, given the direct questions it can answer for managing humanitarian operations.

### Data exploration and visualisation - Correlations

As a preliminary step before checking additional modelling strategies, correlations with the key epidemiological variables is checked.

```{r, figures-2a}
#Fig 2a - correlation between new cases and deaths
tar_read(fig_2_a) +
  labs(x = "Cases", y = "Deaths")
```

A certains degree of correlation is expected between monthly cases and deaths for the different weeks. The linear model fitter on the bidimensional density plot. The correlation is stronger for higher number of new cases, and the trend is roughly linear. Since the disease takes time to kill an infected person, this initial result calls for a lagged correlation model to verify is that link is stronger.

```{r, figures-2b}
#Fig 2b - correlation between new cases and cfr
tar_read(fig_2_b) +
  ylim(-0.2,3)
```

The same pattern is not so evident for the Case Fatality Rate, even if higher nuber of cases is associated with a higher CFR in the same period. Even in this case, the preliminary model suggests a different approach incorporating lag considerations of a couple of weeks.

```{r,figures-2c-upper, fig.show="hold", out.width="50%"}
#Fig 2c - correlation between status and 4 epi variables (4 panels)
tar_read(fig_2c_1)
tar_read(fig_2c_2)
```

```{r,figures-2c-lower, fig.show="hold", out.width="50%"}
#Fig 2c - correlation between status and 4 epi variables (4 panels)
tar_read(fig_2c_3)
tar_read(fig_2c_4)
```

The way the status variable was built forces a certain level of correlation among the variables. This is less evident for the first two variables (cases and deaths), since Attack rate and CFR are used to determine them.

### Time series

There are several methods to control for long-term and seasonal patterns in time series studies. Given the limited number of years, no seasonality can be modelled. The long-term component is added to the model since the cases' growth was slowly increasing. It is expected to be non-linear by applying splines to model smooth temporal trends, initially with 5 degrees of freedom for each year of data.

```{r}
tar_read(epi_conf)
```

The initial model is a more sofisticated version of the plot shown above, with a clear indication that the epidemiological variables and the temporal components have an effect on the outcome. This association is not very strong, as the residual deviance is still similar to the Null one. Thus, it is not easy to determine the status from the original variables, but that is expected, since the presented model does not take into account any lag effect or geographical considerations.

In the second iteration, the association between the Status and the four epidemiological variables (in the previous month) is evaluated, accounting for lagged associations up to four weeks. A bi-dimensional exposure-lag-response function is defined (cross-basis), with 4 different models which can be fit from them.

```{r,figures-3a-1, fig.show="hold", out.width="50%"}
tar_load(ycc_lag)
cb_cases <- dlnm::crossbasis(
  ycc_lag["cases_4w"],
  lag=4,
  argvar=list(fun="lin"),
  arglag=list(fun="integer")
)
spltime <- splines::bs(ycc_lag$date, df=2*3)
mod_cases <- glm(status ~ cb_cases + spltime,
                 family=quasipoisson(),
                 ycc_lag)

cp_cases <- dlnm::crosspred(cb_cases, mod_cases, at=0:6000, by=10)
plot(cp_cases, "slices", var=3000, ci="bars", pch=19, col=2, main="Alternative lag-response functions at Cases = 1200")
plot(cp_cases, "overall", ci="lines", col=2, lty=2,
      main="Overall cumulative association", lwd=2, xlab="New cases")

```

```{r,figures-3a-2, fig.show="hold", out.width="50%"}
cb_deaths <- dlnm::crossbasis(
  ycc_lag["deaths_4w"],
  lag=4,
  argvar=list(fun="lin"),
  arglag=list(fun="integer")
)
spltime <- splines::bs(ycc_lag$date, df=2*3)
mod_deaths <- glm(status ~ cb_deaths + spltime,
                 family=quasipoisson(),
                 ycc_lag)

cp_deaths <- dlnm::crosspred(cb_deaths, mod_deaths, at=0:50, by=1)
plot(cp_deaths, "slices", var=20, ci="bars", pch=19, col=2, main="Alternative lag-response functions at Deaths = 20")
plot(cp_deaths, "overall", ci="lines", col=2, lty=2,
      main="Overall cumulative association", lwd=2, xlab="New deaths")

```

```{r,figures-3a-3, fig.show="hold", out.width="50%"}
cb_cfr <- dlnm::crossbasis(
  ycc_lag["cfr_4w"],
  lag=4,
  argvar=list(fun="lin"),
  arglag=list(fun="integer")
)
spltime <- splines::bs(ycc_lag$date, df=2*3)
mod_cfr <- glm(status ~ cb_cfr + spltime,
                 family=quasipoisson(),
                 ycc_lag)

cp_cfr <- dlnm::crosspred(cb_cfr, mod_cfr, at=0:5, by=0.1)
plot(cp_cfr, "slices", var=1, ci="bars", pch=19, col=2, main="Alternative lag-response functions at CFR = 1")
plot(cp_cfr, "overall", ci="lines", col=2, lty=2,
      main="Overall cumulative association", lwd=2, xlab="CFR")

```

```{r,figures-3a-4, fig.show="hold", out.width="50%"}
cb_ar <- dlnm::crossbasis(
  ycc_lag["attack_4w"],
  lag=4,
  argvar=list(fun="lin"),
  arglag=list(fun="integer")
)
spltime <- splines::bs(ycc_lag$date, df=2*3)
mod_ar <- glm(status ~ cb_ar + spltime,
                 family=quasipoisson(),
                 ycc_lag)

cp_attack <- dlnm::crosspred(cb_ar, mod_ar, at=0:5, by=0.05)
plot(cp_attack, "slices", var=3, ci="bars", pch=19, col=2, main="Alternative lag-response functions at Attack Rate = 3")
plot(cp_attack, "overall", ci="lines", col=2, lty=2,
      main="Overall cumulative association", lwd=2, xlab="Attack rate")
```

The effect at a particular cut-off and the overall cumulative association are shown. None of the charts contain any significant result for any lag of 1 week or more. Thus, modelling only from epidemiological variables is insufficient to accurately predict the status. In addition to that, the residual deviance from the models (not shown) is similar to the initial model, without any benefit in the residual variance from the additional lag considerations.

Last iteration is to verify the association at the single governorate level, a due stage approach is used:

-   A regression model in which the association of interest is estimated in each location, identical to the first model developed above;

-   A meta-analysis to pool the estimates across locations.

This does not take into consideration to effect of geographical proximity, only the temporal association across the estimates.

```{r,figures-3b, fig.show="hold", out.width="33%"}
tar_load(log_epi)
regs <- log_epi[["Governorate"]] |> unique()

uni_cases <- metafor::rma(
  yi=log_epi[["Cases"]], 
  sei=log_epi[["CasesSE"]],
  slab=regs,
  measure="RR"
  )
metafor::forest(uni_cases, transf=exp, refline=1, pch=23, bg=4, col=2,
  main="New cases and Status")

uni_deaths <- metafor::rma(
  yi=log_epi[["Deaths"]], 
  sei=log_epi[["DeathsSE"]],
  slab=regs,
  measure="RR"
  )
metafor::forest(uni_deaths, transf=exp, refline=1, pch=23, bg=4, col=2,
  main="New deaths and Status")

uni_cfr <- metafor::rma(
  yi=log_epi[["CFR"]], 
  sei=log_epi[["CFRSE"]],
  slab=regs,
  measure="RR"
  )
metafor::forest(uni_cfr, transf=exp, refline=1, pch=23, bg=4, col=2,
  main="CFR and Status")

```

Even in this case, no significant result is obtained. The different strengths of associations across the district, each for the epidemiological variables are not strong enough to explain a change in Status.

### Ecological Trends

Modelling ecological trends requires the definition of the proper target variable. In each particular week, the model will try to predict the status of that particular district in the following one (so with a one week lag).

Three models are tested, with different epidemiological variables (either cases or attack rate, as they were the only ones in the previous section to show some kind of cumulative association) and the status of the districts as covariates. To provide a reference, a poisson-gamma model with no spatial consideration is used as a reference.

#### Model 0 - no spatial component

The first model is a simple Poisson-gamma model with no spatial consideration. Variables are the expected number of cases and the status in the previous week, to predict the status in the following one.

```{r}
tar_read(mod0) |> summary()
```

The results, despite showing a significative association for both of the variables, are non-indicative by themselves and are to be considered as a baseline.

#### Model 1 - Cases

The first BYM Model is similar to the former one, but with additional spatial considerations.

Since this is a pilot project, due to computational complexity, only the BYM model for Early December (Epi week 2017-51) is run.

```{odc}
model
{
	for (i in 1 : 21)
	{
			target_status[i]  ~ dpois(mu[i])
			log(mu[i]) <- log(cases_exp[i]) + alpha0 + b.ete[i] + b.clu[i] + alpha1*status[i]
			rr[i] <- exp(alpha0+b.ete[i]+b.clu[i]) 
			b.ete[i]~dnorm(0,tau.ete)
			post[i]<-step(rr[i]-1)
	}
	
	b.clu[1:21] ~ car.normal(adj[], weights[],num[],tau.clu)
	
	sd.clu<-sd(b.clu[])
	sd.ete<-sd(b.ete[])
	
	alpha0  ~ dflat()
	alpha1  ~ dnorm(0, 0.0001)
	tau.ete ~ dgamma(0.5,0.0005)
	sigma.ete <-sqrt(1/tau.ete)
	tau.clu ~ dgamma(0.5,0.0005)
	sigma.clu <-sqrt(1/tau.clu)
}
```

After proper initializing this models, we can provide a summary of the estimate coefficient of status. This shows a tendency towards a negative value of the Status variable, where higher statuses (equal to "worse sitaution") are inversely associate with a higher status in any particular region.

![Posterior probability of the Status coefficient (model 1)](images/mod1_alpha1.jpg)

```{r}
tar_read(mod1_alphas)
```

On the other hand, the effect of alpha0 appears way greater in size.

#### Model 2 - Attack rate

```{odc}
model
{
	for (i in 1 : 21)
	{
			target_status[i]  ~ dpois(mu[i])
			log(mu[i]) <- log(cases_exp[i]) + alpha0 + b.ete[i] + b.clu[i] + alpha1*status[i]
			rr[i] <- exp(alpha0+b.ete[i]+b.clu[i]) 
			b.ete[i]~dnorm(0,tau.ete)
			post[i]<-step(rr[i]-1)
	}
	
	b.clu[1:21] ~ car.normal(adj[], weights[],num[],tau.clu)
	
	sd.clu<-sd(b.clu[])
	sd.ete<-sd(b.ete[])
	
	alpha0  ~ dflat()
	alpha1  ~ dnorm(0, 0.0001)
	tau.ete ~ dgamma(0.5,0.0005)
	sigma.ete <-sqrt(1/tau.ete)
	tau.clu ~ dgamma(0.5,0.0005)
	sigma.clu <-sqrt(1/tau.clu)
}
```

![Posterior probability of the Status coefficient (model 2)](images/mod2_alpha1.jpg)

```{r}
tar_read(mod2_alphas)
```

Alpha 1 is similar to the previous model, even if an opposite effect for alpha0 is shown.

## Conclusions

Cholera spatial dynamics remain elusive as we try to model them. This short report analysed some of the temporal and spatial patterns (but not the two together), as an exploratory moment before different techniques are tested.

The status classification doesn't fully capture the outbreak evolution, as it was shown in the two analysis, but it is somewhat indicative of a predictive power on the following week evolution. The negative coefficient derived in both of BYM models, compared with the close-to-zero one, shows that when spatial relationships are accounted for, there is an inverse relationship between the status of a district and the ones of the others.

## Acknowledgements {.appendix}

This report (and package) has been prepared as part of the Geostatistics for Health Master's Degree as the final project work. Data has been acquired through Humanitarian Data Exchange (see relevant section above on data sources), kindly contributed by the United Nations Office for the Coordination of Humanitarian Affairs (UN OCHA) and the World Health Organisation (WHO) together with the Yemen Ministry of Health.

## Author Contributions {.appendix}

AP prepared the first draft of the analysis plan, which FP and DC discussed and improved and provided ongoing feedback on. CL developed the claims analysis template.

## Environment {.appendix}

<details>

<summary>Session info</summary>

```{r, results='markup'}
devtools::session_info()
```

</details>
